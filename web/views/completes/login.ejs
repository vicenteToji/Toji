<%- include('../partials/header') %>

<main class="login-container">
    <div class="login-card">
        <div class="nav-logo">
            <h2>TOJI</h2>
        </div>
        
        <h1 id="auth-title">Iniciar Sesión</h1>
        <p class="workout-meta" id="auth-subtitle">Introduce tus credenciales para entrenar</p>

        <form id="auth-form" style="margin-top: 20px;">
            <div class="form-group">
                <input type="email" id="email" placeholder="Correo electrónico" required>
            </div>
            <div class="form-group">
                <input type="password" id="password" placeholder="Contraseña" required>
            </div>
            
            <button type="submit" id="submit-btn" class="btn-login" style="width: 100%; border: none; cursor: pointer; margin-top: 10px;">
                Entrar
            </button>
        </form>

        <div style="margin-top: 20px;">
            <p class="workout-meta">
                <span id="toggle-text">¿No tienes cuenta?</span> 
                <a href="#" id="toggle-auth" style="color: var(--accent-color); text-decoration: none; font-weight: bold;">Regístrate</a>
            </p>
        </div>
        <div id="message" style="margin-top: 15px; font-size: 0.9rem; min-height: 20px;"></div>
    </div>
</main>

<% if (error) { %>
    <p style="color: red; text-align: center; margin-top: 20px;"><%= error %></p>
<% } %>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

<script>

const firebaseConfig = {
     apiKey: "AIzaSyA0w8YQWXLYoblPD2Ma1Ly0_tHN7c_Qu04",
  authDomain: "toji-gym.firebaseapp.com",
  projectId: "toji-gym",
  storageBucket: "toji-gym.firebasestorage.app",
  messagingSenderId: "713518995736",
  appId: "1:713518995736:web:8777e9284e86782d21e66d",
  measurementId: "G-V7JQQ0PVR5"
};

firebase.initializeApp(firebaseConfig);

document.querySelector('form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.querySelector('input[type="email"]').value;
    const password = document.querySelector('input[type="password"]').value;

    try {
        const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
        const idToken = await userCredential.user.getIdToken();

        const response = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ idToken })
        });

        if (response.redirected) {
            window.location.href = response.url;
        }
    } catch (error) {
        alert('Error al iniciar sesión: ' + error.message);
    }
});
</script>

<%- include('../partials/footer') %>